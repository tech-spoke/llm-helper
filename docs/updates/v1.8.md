# v1.8 Update

Release Date: 2026-02 (Planned)

## Summary

v1.8 introduces performance optimizations and feature enhancements: improvement cycle log disabling, PRE_COMMIT order change for performance gains, and exploration-only mode (`--only-explore`) for efficient investigation tasks.

**Performance Improvements**:
- v1.7 parallel execution (27-35s reduction): search_text multiple patterns, Read/Grep parallel execution
- v1.8 optimizations (6-9s reduction): Improvement cycle log disabling, PRE_COMMIT order change
- **Total reduction: 33-44 seconds** (approximately 8-11% faster)

## New Features

### 1. Improvement Cycle Log Disabling

The improvement cycle feature (outcomes.jsonl / decisions.jsonl, introduced in v1.0) had the following issues:

1. **Non-functional**:
   - `get_session_status` does not return completed sessions
   - Step 0 failure detection does not work
   - Similarity matching is unimplemented

2. **Performance impact**:
   - Step 0: Failure check (2-3s)
   - Step 11: `record_outcome` call (2-3s)
   - Total: 4-6s wasted

**Changes**:
- `tools/outcome_log.py`: File writes disabled
- `code_intel_server.py`: `record_decision` calls removed
- `.claude/commands/code.md`: Step 0 disabled

**Reduction**: 4-6 seconds (2-3 LLM round-trips)

---

### 2. EXPLORATION Phase Parallelization (v1.7 implementation)

**Note**: This feature was implemented in v1.7 and is available in v1.8 as an existing capability.

`search_text` extended to support multiple patterns for parallel execution:

**Usage**:
```python
# Single pattern
search_text(pattern="modal")

# Multiple patterns (parallel execution)
search_text(patterns=["modal", "background", "overlay"])
```

**Reduction**: 20 seconds (52s → 32s, 38% reduction)

For details, see [v1.7 Update](v1.7.md).

---

### 3. PRE_COMMIT + QUALITY_REVIEW Order Change

**Current implementation**: Quality check after commit:

```
Current flow:
Step 10: PRE_COMMIT
  ├─ review_changes (garbage detection + keep/discard)
  ├─ finalize_changes (commit execution) ★Commit here
  └─ PRE_COMMIT complete

Step 10.5: QUALITY_REVIEW
  ├─ Quality check based on quality_review.md
  ├─ Issues found → Revert to READY (after fix, new commit in PRE_COMMIT)
  └─ No issues → merge_to_base
```

**Problems**:
1. **Quality check after commit** → More commits on rework
2. **Git history complexity**: New commit created for each fix
3. **Inefficiency**: One commit would suffice with quality check before commit

**Improved flow**: Quality check before commit:

```
Improved flow:
Step 10: PRE_COMMIT (integrated flow)
  ├─ review_changes (garbage detection + keep/discard)
  ├─ Quality check (quality_review.md)
  ├─ Issues found?
  │   YES → Revert to READY
  │   NO  → finalize_changes (commit execution) ★Commit if no issues
  └─ To merge_to_base
```

**Implementation**:
- `tools/session.py`: Added commit preparation state fields
- `tools/branch_manager.py`: Added `execute_commit=False` parameter, `execute_prepared_commit()` method
- `code_intel_server.py`: Modified `finalize_changes` and `submit_quality_review`

**Reduction**: 2-3 seconds (eliminates extra commit round-trip on quality issues)

---

### 4. Exploration-Only Mode (Intent-based + --only-explore)

#### Background

For investigation tasks such as codebase problem analysis or impact assessment without implementation, the following issues existed:

1. **Unnecessary phase execution**:
   - READY, POST_IMPL_VERIFY, PRE_COMMIT, QUALITY_REVIEW executed even when only exploration was needed
   - No option to skip implementation phases

2. **Gaps in existing options**:
   - `--only-verify`: Verification only (skips exploration too)
   - `--quick` / `--fast`: Skip exploration (executes implementation)
   - No "exploration-only" option

#### Changes

Exploration-only mode is achieved through **two methods**:

##### A. Intent-based Automatic Mode

**Automatic configuration via Intent Classification**:
- Intent=INVESTIGATE or Intent=QUESTION → Automatically sets `skip_implementation=true`, `skip_branch=true`
- No flag required (system auto-detects)

**Usage examples**:
```bash
# These automatically enter exploration-only mode
/code What is the implementation of sample/calculator.py?  # Intent=QUESTION
/code Investigate how authentication is implemented  # Intent=INVESTIGATE
```

##### B. --only-explore Flag (Explicit Override)

**Exploration-only mode for any Intent**:
- Explicitly specify with `--only-explore` / `-e` flag
- Can force exploration-only even for Intent=IMPLEMENT/MODIFY

**Usage examples**:
```bash
# Investigation only, no implementation
/code --only-explore Add login feature  # Intent=IMPLEMENT but exploration only
/code -e Fix this bug  # Intent=MODIFY but exploration only
```

**Comparison of the two methods**:
| Method | Trigger | Intent | Branch |
|--------|---------|--------|--------|
| Intent-based | Automatic (INVESTIGATE/QUESTION) | INVESTIGATE/QUESTION | Not created |
| --only-explore | Explicit flag | Any | Not created |

**Executed phases** (common to both):
```
✅ DOCUMENT_RESEARCH
✅ EXPLORATION (find_definitions, find_references, search_text)
✅ Symbol Validation
✅ SEMANTIC (if needed)
✅ VERIFICATION (if needed)
✅ IMPACT_ANALYSIS
✅ Report findings to user
❌ READY (implementation) - Skipped
❌ POST_IMPL_VERIFY - Skipped
❌ PRE_COMMIT - Skipped
❌ QUALITY_REVIEW - Skipped
❌ Branch creation - None (exploration only)
```

**Phase matrix**:
| Option | Explore | Implement | Verify | Intervention | Garbage | Quality | Branch |
|--------|:-------:|:---------:|:------:|:------------:|:-------:|:-------:|:------:|
| Intent=INVESTIGATE/QUESTION | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| `--only-explore` / `-e` | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |

#### Implementation Details

**File changes**:

1. `.claude/commands/code.md`:
   - Added INVESTIGATE/QUESTION explanation to Step 1: Intent Classification
   - Added Intent-based skip_implementation auto-configuration to Step 2: Session Start
   - Added skip_branch determination logic to Step 3.5: begin_phase_gate (skip_implementation=true → skip_branch=true)
   - Added `--only-explore` / `-e` processing to Step -1: Flag Check
   - Added exploration completion handling to Step 8: IMPACT_ANALYSIS

2. `tools/session.py`:
   - Added `skip_implementation: bool` flag to `SessionState`
   - Modified `submit_impact_analysis` to return `exploration_complete=true` when `skip_implementation=True`

3. `code_intel_server.py`:
   - Added `skip_implementation` parameter to `start_session`
   - Added skip_implementation check to `begin_phase_gate` (skip_implementation=true → skip_branch=true, phase=EXPLORATION)

**Branch creation fix**:
- No branch is created in exploration-only mode (skip_implementation=true)
- `begin_phase_gate` automatically sets skip_branch=true
- Reason: No code changes in exploration-only, so branch is unnecessary

**Performance impact**: None (extends functionality rather than reducing time)

**Use cases**:
- Codebase problem investigation (Intent=INVESTIGATE auto-detects)
- Security audit preliminary research (Intent=INVESTIGATE auto-detects)
- Architecture understanding (Intent=QUESTION auto-detects)
- Impact analysis (Intent=INVESTIGATE auto-detects, or --only-explore explicit)

---

## Breaking Changes

- None

## Bug Fixes

- None

---

## Related Changes

- `.claude/commands/code.md`: Flag definition and phase flow updated
- `tools/session.py`: Session state extended with skip_implementation flag
- `code_intel_server.py`: Session creation parameter extended
- `README.md` / `README_ja.md`: Documentation updated with new option
