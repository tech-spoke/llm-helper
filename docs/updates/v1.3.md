# v1.3 Update / v1.3 アップデート

Release Date: 2025-01

## Summary / 概要

v1.3 adds Document Research phase using sub-agents and lightweight markup cross-reference analysis.

v1.3 ではサブエージェントを使用したドキュメント調査フェーズと、マークアップファイルの軽量クロスリファレンス分析を追加。

## New Features / 新機能

### DOCUMENT_RESEARCH Phase (Step 2.5)

New phase after session start that researches design documents using Claude Code's Task tool.

**Two-Layer Context Architecture:**

| Layer | Source | Purpose |
|-------|--------|---------|
| project_rules | CLAUDE.md | Always-needed baseline (static) |
| mandatory_rules | docs/ via sub-agent | Task-specific constraints (dynamic) |

**Workflow:**
1. Sub-agent (Explore type) reads docs/ directory
2. Extracts rules relevant to current task
3. Returns `mandatory_rules`, `dependencies`, `warnings`
4. Rules must be acknowledged in `submit_understanding`

**Configuration (`context.yml`):**
```yaml
doc_research:
  enabled: true
  docs_path:
    - "docs/"
  default_prompts:
    - "default.md"
```

**Command Options:**
```
/code --doc-research=security add auth  # Use specific prompts
/code --no-doc-research fix typo        # Skip research
```

### Markup Cross-Reference Analysis

Even in relaxed markup mode, cross-references between CSS/HTML/JS are detected.

| Target | Searches | Detects |
|--------|----------|---------|
| CSS/SCSS | HTML files | Class/ID usage |
| HTML | CSS/SCSS files | Style definitions |
| HTML | JS/TS files | getElementById, querySelector |

**Response Example:**
```json
{
  "mode": "relaxed_markup",
  "static_references": {
    "html_files": [
      {"file": "index.html", "identifier": "btn-primary"}
    ]
  },
  "confirmation_required": {
    "should_verify": ["index.html"]
  }
}
```

### Rule Acknowledgment

When DOCUMENT_RESEARCH is executed, `submit_understanding` requires:
- `rule_acknowledgment`: List of mandatory rule IDs
- `rule_compliance_plan`: How each rule will be followed

### Auto-Detection

If `docs_path` is not configured, automatically detects:
1. `docs/` directory
2. `DESIGN*.md` files
3. `README.md` as fallback

## Breaking Changes / 破壊的変更

- `essential_docs` in context.yml is deprecated (use `doc_research` instead)
- INTERNALS documents merged into DESIGN docs

## Command Options / コマンドオプション

| Long | Short | Description |
|------|-------|-------------|
| `--doc-research=PROMPTS` | - | Specify research prompts |
| `--no-doc-research` | - | Skip document research |

## Bug Fixes / バグ修正

- Fixed: `enable_overlay` was not being passed in `/code` command
- Fixed: Markup relaxation now includes `.sass` and `.less` extensions
