# v1.4 Update

Release Date: 2025-01

## Summary

v1.4 adds the Retry-Based Intervention System to break "stuck" loops when verification fails repeatedly.

## New Features

### Intervention System

Detects when LLM is stuck in repeated verification failures and guides it to reconsider the approach.

**Workflow:**
```
Verification fails 3+ times
    ↓
Server returns failure_history
    ↓
LLM analyzes failures and selects intervention prompt
    ↓
LLM reads intervention prompt and follows instructions
    ↓
Revert changes and try different approach
```

**Default Intervention Prompts:**

| File | Purpose | When to Select |
|------|---------|----------------|
| `structure_review.md` | Review structure | Layout/positioning adjustments repeating |
| `hypothesis_review.md` | Review hypothesis | Error messages changing each time |
| `step_back.md` | Step back and reconsider | General stuck state |
| `user_escalation.md` | Escalate to user | 2+ interventions without resolution |

**Force Escalation:** After 2 interventions without success, `user_escalation.md` is mandatory.

**Usage:**
```bash
# Standard mode (intervention enabled)
/code fix this bug

# Skip intervention system
/code --no-intervention fix simple typo
/code -ni fix simple typo
```

### Final Report Suggestions

After task completion, LLM suggests new prompts based on session experience:

**Intervention Prompt Suggestion:**
- Triggered when `intervention_count >= 1`
- Suggests new `.code-intel/interventions/{pattern}_review.md`

**Verifier Prompt Suggestion:**
- Triggered when `verification_failures >= 2`
- Suggests improvements to `.code-intel/verifiers/{category}.md`

### New Command Options

| Long | Short | Description |
|------|-------|-------------|
| `--no-intervention` | `-ni` | Skip intervention system |

### Configuration

`.code-intel/context.yml`:
```yaml
interventions:
  enabled: true
  prompts_dir: "interventions/"
  threshold: 3  # Failures before intervention
  force_escalation_after: 2  # Force user_escalation after N interventions
  suggest_new_prompts: true  # Suggest new prompts in final report
  patterns:
    - threshold: 3
      pattern: "css_layout"
      prompts: ["structure_review", "user_escalation"]
    - threshold: 3
      pattern: "filament"
      prompts: ["hypothesis_review", "user_escalation"]
    - threshold: 3
      pattern: "default"
      prompts: ["step_back"]

verifiers:
  suggest_improvements: true  # Suggest improvements in final report
```

## Breaking Changes

- None

## Bug Fixes

- None
