# v1.2 アップデート

> **⚠️ 廃止済み / DEPRECATED**
>
> OverlayFS は v1.2.1 で削除されました。現在は Git ブランチ分離のみを使用しています。
> OverlayFS was removed in v1.2.1. Now uses Git branch isolation only.

Release Date: 2025-01

## 概要

~~v1.2 では OverlayFS によるガベージ検出と、探索フェーズの厳格さを制御する gate level を追加。~~

**v1.2.1**: Git ブランチ分離に変更（OverlayFS 削除）。

## 新機能

### OverlayFS によるガベージ検出

実装時のすべてのファイル変更をキャプチャし、コミット前にレビュー可能。

**ワークフロー:**
1. `start_session` で `enable_overlay: true` を指定するとタスクブランチを作成
2. OverlayFS がすべての変更を upper ディレクトリにキャプチャ
3. `review_changes` で全修正の diff を確認
4. `finalize_changes` でファイルごとに keep/discard を決定
5. 意図した変更のみでクリーンなコミット

**使用例:**
```
mcp__code-intel__start_session
  intent: "IMPLEMENT"
  query: "機能を追加"
  enable_overlay: true  # ガベージ検出を有効化
```

**要件:**
- `fuse-overlayfs` がインストール済み
- Git リポジトリが初期化済み

### Gate Level 制御

探索フェーズ要件の厳格さを制御。

| Level | 説明 |
|-------|------|
| `high` | 厳格な要件（デフォルト） |
| `middle` | 標準的な要件 |
| `low` | 緩和された要件 |
| `auto` | リスクに基づいてサーバーが判断 |
| `none` | 探索をスキップし、直接READYへ |

**使用例:**
```
/code -g=m バリデーションを追加   # middle gate
/code -q typo修正                # クイックモード (= -g=n)
```

### 新しいフェーズ

| フェーズ | 説明 |
|---------|------|
| PRE_COMMIT | コミット前に変更をレビュー（overlay有効時） |
| Finalize | コミットし、オプションでmainにマージ |

### クリーンアップコマンド

中断されたセッションの stale なオーバーレイをクリーンアップ:
```
/code --clean
```

## コマンドオプション

| Long | Short | 説明 |
|------|-------|------|
| `--gate=LEVEL` | `-g=LEVEL` | gate level を設定 |
| `--quick` | `-q` | 探索をスキップ (= `-g=n`) |
| `--clean` | `-c` | stale なオーバーレイをクリーンアップ |
| `--rebuild` | `-r` | 全インデックスを強制再構築 |

## バグ修正

- なし
